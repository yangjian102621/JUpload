!function(e){void 0==Array.prototype.remove&&(Array.prototype.remove=function(e){for(var t=0;t<this.length;t++)if(this[t]==e){this.splice(t,1);break}}),e.fn.imageCrop||(e.fn.imageCrop=function(t,n){e(this).on("load",function(){var a,i,o,r,s=this.width/this.height,c=t/n;s>=c?(i=n,a=t*s,r=0,o=(a-t)/2):(a=t,i=n/s,o=0,r=0),e(this).css({position:"absolute",top:-r+"px",left:-o+"px",width:a+"px",height:i+"px"})})}),e.fn.JUpload=function(n){function a(n){var a=new t;a.append('<div class="img-wrapper"><div class="img-container" style="width: '+i.twidth+"px; height: "+i.theight+'px">'),a.append('<img src="'+n+'">'),a.append('<div class="file-opt-box clearfix"><span class="remove">删除</span></div></div></div>');var r=e(a.toString());e("#"+i.image_container).append(r),r.find("img").imageCrop(i.twidth,i.theight),r.find(".remove").on("click",function(){try{var t=e(this).parent().prev().attr("src");o.remove(t),r.remove(),i.onRemove(o)}catch(n){console.log(n)}}),o.push(n),i.onSuccess(o)}var i=e.extend({src:"src",url:null,onSuccess:function(e){},onRemove:function(e){},image_container:null,max_filenum:0,datas:[],twidth:113,theight:113},n),o=[];if(i.datas.length>0){for(var r=0;r<i.datas.length;r++)a(i.datas[r]);o=i.datas}var s="iframe_"+Math.random(),c=e('<form action="'+i.url+'" target="'+s+'" enctype="multipart/form-data" method="post"></form>'),p=e('<input type="file" name="'+i.src+'" class="upload-input" />'),l=e('<iframe name="'+s+'" class="upload-iframe"></iframe>');e(this).on("click",function(){p.trigger("click")}),p.on("change",function(){return i.max_filenum>0&&o.length>=i.max_filenum?(alert("您最多允许上传"+i.max_filenum+"张图片。"),!1):void c[0].submit()}),l.on("load",function(){var t=this.contentWindow.document.getElementsByTagName("body")[0].innerHTML;if(!t)return!1;try{var n=e.parseJSON(t);"000"==n.code?null!=i.image_container?a(n.message):i.success(n.message):alert(n.message)}catch(o){console.log(o)}}),c.append(p),e("body").append(c),e("body").append(l),i.image_container&&e("#"+i.image_container).addClass("clearfix")};var t=function(){var e=new Array;t.prototype.append=function(t){e.push(t)},t.prototype.toString=function(){return e.join("")}}}(jQuery);