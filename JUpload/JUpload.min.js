!function(e){void 0==Array.prototype.remove&&(Array.prototype.remove=function(e){for(var t=0;t<this.length;t++)if(this[t]==e){this.splice(t,1);break}}),e.fn.imageCrop||(e.fn.imageCrop=function(t,n){e(this).on("load",function(){var i,a,o,r,s=this.width/this.height,c=t/n;s>=c?(a=n,i=t*s,r=0,o=(i-t)/2):(i=t,a=n/s,o=0,r=0),e(this).css({position:"absolute",top:-r+"px",left:-o+"px",width:i+"px",height:a+"px"})})});var t=document.scripts,n=t[t.length-1],i=n.src,a=i.substring(0,i.lastIndexOf("/")+1)+"css/JUpload.css";e("head:eq(0)").append('<link href="'+a+'" rel="stylesheet" type="text/css" />'),e.fn.JUpload=function(t){function n(t){var n=new o;n.append('<div class="img-wrapper"><div class="img-container" style="width: '+c.twidth+"px; height: "+c.theight+'px">'),n.append('<img src="'+t+'">'),n.append('<div class="file-opt-box clearfix"><span class="remove">删除</span></div></div></div>');var i=e(n.toString());e("#"+c.image_container).append(i),i.find("img").imageCrop(c.twidth,c.theight),i.find(".remove").on("click",function(){try{var t=e(this).parent().prev().attr("src");l.remove(t),i.remove(),c.onRemove(l),d--}catch(n){console.log(n)}}),l.push(t)}function i(t){if(a(t)){var i=new XMLHttpRequest;i.open("POST",c.url),i.addEventListener("load",function(t){var i=e.parseJSON(t.target.responseText);"000"==i.code?(null!=c.image_container&&n(i.item),d++,c.onSuccess(i.item)):(s("上传失败"),c.onError()),c.onSuccess(t)},!1),i.addEventListener("loadend",function(){c.onComplete()},!1),i.addEventListener("error",function(e){},!1),i.upload.addEventListener("progress",function(e){},!1),i.upload.addEventListener("loadstart",function(e){},!1);var o=new FormData;o.append(c.src,t),i.send(o)}}function a(e){var t=1024*c.maxFileSize*1024;if(t>0&&e.size>t)return s("文件大小不能超过 "+c.maxFileSize+"MB"),c.onError(),!1;var n=r(e.name);return n&&-1!=c.extAllow.indexOf(n)&&-1==c.extRefuse.indexOf(n)?!0:(s("非法的文件后缀 "+n),c.onError(),!1)}function r(e){var t=e.lastIndexOf(".");return-1!=t?e.substr(t+1).toLowerCase():!1}function s(e){c.messageHandler(e)}var c=e.extend({src:"src",url:null,maxFileSize:2,onStart:function(){},onComplete:function(){},onSuccess:function(e){},onError:function(){},onRemove:function(e){},messageHandler:function(e){alert(e)},image_container:null,maxFileNum:5,extAllow:"jpg|png|gif|jpeg",extRefuse:"exe|txt",datas:[],method:"html5",twidth:113,theight:113},t),l=[],d=0;if(c.datas.length>0){for(var u=0;u<c.datas.length;u++)n(c.datas[u]);l=c.datas,d=l.length}var p="iframe_"+Math.random(),m=e('<form action="'+c.url+'" target="'+p+'" enctype="multipart/form-data" method="post"></form>'),f=e('<input type="file" name="'+c.src+'" class="upload-input" />'),h=e('<iframe name="'+p+'" class="upload-iframe"></iframe>');e(this).on("click",function(){f.trigger("click")}),"html5"==c.method&&f.on("change",function(){return c.maxFileNum>0&&d>=c.maxFileNum?(s("您最多允许上传"+c.maxFileNum+"张图片。"),!1):(c.onStart(),void setTimeout(function(){i(f[0].files[0])},200))}),"iframe"==c.method&&(f.on("change",function(){return""==f.val()?(s("请选择文件."),!1):c.maxFileNum>0&&d>=c.maxFileNum?(s("您最多允许上传"+c.maxFileNum+"张图片。"),!1):(c.onStart(),void setTimeout(function(){m[0].submit()},200))}),h.on("load",function(){try{var t=this.contentWindow.document.getElementsByTagName("pre")[0].innerHTML;if(!t)return!1;var i=e.parseJSON(t);"000"==i.code?(null!=c.image_container&&n(i.item),d++,c.onSuccess(i.item),f.val("")):alert(i.message),c.onComplete()}catch(a){}})),m.append(f),e("body").append(m),e("body").append(h),c.image_container&&e("#"+c.image_container).addClass("clearfix")};var o=function(){var e=new Array;o.prototype.append=function(t){e.push(t)},o.prototype.toString=function(){return e.join("")}}}(jQuery);