var TUpload=function(e){function n(){var n='<div class="jupload-container" id="jupload-container">		<div class="jupload-panel" id="jupload-panel">         <div class="image-list-box" id="image-list-box">         </div>     </div>     <div class="jupload-btn-box" id="jupload-btn-box">         <button class="btn-upload"></button>         <button class="btn-add-file"></button>     </div>     <span class="jupload-close"></span></div>';$("body").append(n);var t=$('<div class="init-add-file-btn" id="init-add-file-btn"></div>'),d=$('<input type="file" class="input-select-file" id="input-select-file" multiple="true">'),l=$('<div class="addmore-box" id="addmore-box"><span class="addmore-btn"></span></div>');l.on("click",function(){$("#input-select-file").trigger("click")}),$("#jupload-btn-box  .btn-add-file").on("click",function(){return u.length>0?(alert("请先上传文件！"),!1):(m.length>0&&e.callback(m),void $("#jupload-container").remove())}),$("#jupload-container .jupload-close").on("click",function(){$("#jupload-container").remove()}),$("#jupload-btn-box .btn-upload").on("click",function(){return 0==u.length?(alert("请至少添加一个文件！"),!1):void a(u.shift())}),d.on("change",function(){0==$("#image-list-box").find(".addmore-box").length?$("#image-list-box").append(l):l.show();for(var n=d[0].files,a=$("#jupload-container .img-container").length,t=a;t<a+n.length;t++){if(u.length>=e.maxFileNum){alert("您本次最多上传"+e.maxFileNum+"个文件.");break}var r=$('<div class="img-container" id="img-comtainer-'+t+'">    <div class="image">       <img src="'+window.URL.createObjectURL(n[t-a])+'" width="150" border="0">       <div class="mask">等待上传……</div>     </div>     <div class="file-info">         <div class="progress"><span class="progress-bar" id="upload-progress-bar-'+t+'"></span></div>         <div class="file-size">'+o(n[t-a].size)+'</div>     </div>     <span class="remove" index="'+t+'"></span>     <span class="success"></span></div>');r.find(".remove").on("click",function(){i(this)}),$("#jupload-container  #addmore-box").before(r),u.push(n[t-a])}$("#init-add-file-btn").hide()}),t.append(d),$("#jupload-panel").append(t),t.css({top:($("#jupload-panel").height()-t.height())/2+"px",left:($("#jupload-panel").width()-t.width())/2+"px"});var r=window.document.body.scrollTop||window.document.documentElement.scrollTop,s=$("#jupload-container");s.css({top:r+20+"px",left:($(window).width()-s.width())/2})}function i(e){$(e).parent().remove();var n=$(e).attr("index");u.splice(n,1),0==$(".img-container").length&&($("#init-add-file-btn").show(),addMoreImage.hide()),$("#image-list-box").find(".remove").each(function(e,n){$(n).attr("index",e)})}function o(e){return e/1048576>1?(e/1048576).toFixed(2)+"MB":(e/1024).toFixed(2)+"KB"}function a(n){if(!t(n))return f++,void r();var i=new XMLHttpRequest;i.open("POST",e.uploadUrl),i.addEventListener("load",function(n){if("json"==e.dataType){var i=$.parseJSON(n.target.responseText);0==i.code?(m.push(i.message),$("#img-comtainer-"+f).find(".remove").hide().next().show(),$("#img-comtainer-"+f).find(".mask").hide()):$("#img-comtainer-"+f).find(".mask").html(p[i.code]).addClass("error")}e.onSuccess(n)},!1),i.addEventListener("loadend",function(){f++,r()},!1),i.addEventListener("error",function(n){e.onError(n)},!1),i.upload.addEventListener("progress",function(e){s(e)},!1),i.upload.addEventListener("loadstart",function(n){e.onLoadStart(n)},!1);var o=new FormData;o.append(e.src,n),i.send(o)}function t(n){var i=1024*e.maxFileSize;if(i>0&&n.size>i)return l("文件大小不能超过 "+e.maxFileSize+" KB"),!1;var o=d(n.name);return o&&-1!=e.extAllow.indexOf(o)&&-1==e.extRefuse.indexOf(o)?!0:(l("非法的文件后缀 "+o),!1)}function d(e){var n=e.lastIndexOf(".");return-1!=n?e.substr(n+1).toLowerCase():!1}function l(e){$("#img-comtainer-"+f).find(".mask").html(e).addClass("error")}function r(){if(u.length){var n=u.shift();a(n)}else e.onComplete(),f=0,u=new Array}function s(e){e.lengthComputable&&$("#upload-progress-bar-"+f).css({width:e.loaded/e.total*100+"%"})}if(!window.applicationCache)throw new Error("Your browser version is too low, do not support html5, can not be used AjaxUpload upload the plugin, please upgrade your browser!");var c={src:"src",uploadUrl:null,dataType:"json",maxFileSize:2048,maxFileNum:20,extAllow:"jpg|png|gif|jpeg",extRefuse:"exe|txt",callback:function(e){},onSuccess:function(e){},onError:function(e){},onLoadStart:function(e){},onComplete:function(){$("#addmore-box").hide()}},p={0:"文件上传成功",1:"文件上传失败",2:"文件大小超出限制",3:"非法文件名后缀"};e=$.extend(c,e);var u=new Array,f=0,m=new Array;n()};